The code is rather messy and is currently being improved.
